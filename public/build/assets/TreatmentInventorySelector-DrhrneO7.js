import{r as o,j as e}from"./app-0NEBy9BJ.js";import{S as U,a as L,b as $,c as P,d as H}from"./select-D7GD0hqE.js";import{I as S}from"./input-B5HdwBrp.js";import{B as x}from"./button-HTjkDkdd.js";import{L as y}from"./label-QKzL7hA2.js";import{C as k,a as B,b as E,c as C}from"./card-Bi1LQnVT.js";import{B as z}from"./badge-DRGinVhB.js";import{P as p}from"./scissors-DUdWMhH-.js";import{P as q}from"./plus-CLctK3R5.js";import{T as D}from"./triangle-alert-CrRGYxRV.js";import{H as O}from"./hash-DQDs7CvN.js";import{X as R}from"./x-BmcQdfAq.js";import{D as V}from"./dollar-sign-DyPiHvO_.js";function ne({clinicId:h,value:F=[],onChange:v,disabled:l=!1,showCosts:u=!0}){const[d,T]=o.useState([]),[c,N]=o.useState(!1),[n,g]=o.useState(F);o.useEffect(()=>{h&&f()},[h]),o.useEffect(()=>{v(n)},[n,v]);const f=async()=>{N(!0);try{const s=await fetch(`/clinic/${h}/treatments/inventory/available`);if(s.ok){const a=await s.json();console.log("Fetched inventory:",a),T(a)}else{console.error("Failed to fetch inventory:",s.status,s.statusText);const a=await s.json().catch(()=>({}));console.error("Error details:",a)}}catch(s){console.error("Error fetching inventory:",s)}finally{N(!1)}},b=()=>{g([...n,{inventory_id:"",quantity_used:1,notes:""}])},j=(s,a,t)=>{const i=[...n];i[s][a]=t,g(i)},A=s=>{const a=n.filter((t,i)=>i!==s);g(a)},w=s=>{const a=d.find(t=>t.id==s);return a||{id:s,name:"Unknown Item (Deleted)",description:"This inventory item may have been deleted or renamed",unit_price:0,quantity:0,is_low_stock:!1}},I=()=>n.reduce((s,a)=>{const t=w(a.inventory_id);return t&&a.quantity_used?s+t.unit_price*a.quantity_used:s},0),m=s=>"â‚±"+parseFloat(s||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2});return e.jsxs(k,{className:"w-full border border-gray-200 shadow-sm",children:[e.jsxs(B,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{className:"text-lg font-semibold flex items-center gap-2 text-gray-800",children:[e.jsx(p,{className:"h-5 w-5 text-blue-600"}),"Inventory Items Used"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{type:"button",variant:"ghost",size:"sm",onClick:f,disabled:l||c,className:"flex items-center gap-1 hover:bg-blue-100",children:[e.jsx(p,{className:"h-4 w-4"}),"Refresh"]}),e.jsxs(x,{type:"button",variant:"outline",onClick:b,disabled:l||c,className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-50",children:[e.jsx(q,{className:"h-4 w-4"}),"Add Item"]})]})]}),u&&n.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border border-blue-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Items"})]}),e.jsx("div",{className:"w-px h-8 bg-gray-300"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m(I())}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Cost"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Average per item"}),e.jsx("div",{className:"text-lg font-semibold text-gray-800",children:n.length>0?m(I()/n.length):"â‚±0.00"})]})]})})]}),e.jsxs(C,{className:"space-y-4",children:[c&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading inventory..."})]}),!c&&d.length===0&&e.jsxs("div",{className:"text-center py-6 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(D,{className:"h-8 w-8 mx-auto mb-2 text-yellow-600"}),e.jsx("p",{className:"text-sm font-medium text-yellow-800 mb-1",children:"No Available Inventory"}),e.jsxs("p",{className:"text-xs text-yellow-700",children:["No active inventory items with stock available.",e.jsx("br",{}),"Check your inventory management or add new items."]})]}),n.length>0&&e.jsx("div",{className:`grid gap-4 ${n.length===1?"grid-cols-1":"grid-cols-1 lg:grid-cols-2"}`,children:n.map((s,a)=>{const t=w(s.inventory_id),i=t&&t.quantity<=t.minimum_quantity,_=t&&s.quantity_used?t.unit_price*s.quantity_used:0;return e.jsx(k,{className:"border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs(C,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full",children:e.jsx(O,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-700",children:["Item ",a+1]}),t&&e.jsx(z,{variant:"outline",className:"text-xs ml-2 border-blue-200 text-blue-700",children:t.category})]})]}),e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>A(a),disabled:l,className:"h-8 w-8 p-0 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full",children:e.jsx(R,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:`inventory_${a}`,className:"text-sm font-medium",children:"Inventory Item *"}),e.jsxs(U,{value:s.inventory_id?s.inventory_id.toString():"",onValueChange:r=>j(a,"inventory_id",r),disabled:l,children:[e.jsx(L,{className:"mt-1",children:e.jsx($,{placeholder:"Select inventory item"})}),e.jsx(P,{children:d.length===0?e.jsx("div",{className:"p-2 text-sm text-gray-500 text-center",children:"No inventory items available"}):d.map(r=>e.jsx(H,{value:r.id.toString(),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.category," ","â€¢ â‚±",parseFloat(r.unit_price).toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["Stock:"," ",r.quantity]})]})},r.id))})]}),t&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Selected:"})," ",e.jsx("span",{className:t.name==="Unknown Item (Deleted)"?"text-red-600 font-medium":"",children:t.name}),t.name==="Unknown Item (Deleted)"?e.jsx("span",{className:"ml-2 text-red-500 text-xs",children:"(Item deleted/renamed)"}):e.jsxs("span",{className:"ml-2 text-green-600",children:["(â‚±",parseFloat(t.unit_price).toLocaleString("en-PH",{minimumFractionDigits:2})," ","per unit)"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:`quantity_${a}`,className:"text-sm font-medium",children:"Quantity Used *"}),e.jsx(S,{id:`quantity_${a}`,type:"number",min:"1",value:s.quantity_used,onChange:r=>j(a,"quantity_used",parseInt(r.target.value)||1),disabled:l,className:"mt-1"}),t&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Available:"," ",t.quantity]}),u&&e.jsxs("span",{className:"font-medium text-green-600",children:["Total:"," ",m(_)]})]}),e.jsx("div",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"ðŸ’¡ Smart validation: Backend will calculate net differences for updates"})]})]})]}),u&&t&&e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-green-100 rounded-full",children:e.jsx(V,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold ${t.name==="Unknown Item (Deleted)"?"text-red-800":"text-green-800"}`,children:"Cost Breakdown"}),t.name==="Unknown Item (Deleted)"?e.jsx("p",{className:"text-xs text-red-600",children:"Item deleted - cost unavailable"}):e.jsxs("p",{className:"text-xs text-green-700",children:[s.quantity_used," ","Ã— â‚±",parseFloat(t.unit_price).toLocaleString("en-PH",{minimumFractionDigits:2})," ","per unit"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-xl font-bold ${t.name==="Unknown Item (Deleted)"?"text-red-800":"text-green-800"}`,children:t.name==="Unknown Item (Deleted)"?"N/A":m(_)}),e.jsx("p",{className:`text-xs ${t.name==="Unknown Item (Deleted)"?"text-red-600":"text-green-600"}`,children:"Total Cost"})]})]})}),i&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(D,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("span",{className:"text-sm text-yellow-700",children:["Low stock warning: Only"," ",t.quantity," ","units remaining"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(y,{htmlFor:`notes_${a}`,className:"text-sm font-medium",children:"Usage Notes (Optional)"}),e.jsx(S,{id:`notes_${a}`,value:s.notes,onChange:r=>j(a,"notes",r.target.value),placeholder:"e.g., Applied to tooth #14, Patient allergic to latex...",disabled:l,className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add any specific notes about how this item was used in the treatment"})]})]})},a)})}),n.length===0&&!c&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(p,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"No inventory items selected"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Click "Add Item" to select inventory items used in this treatment'}),e.jsxs(x,{type:"button",variant:"outline",onClick:b,disabled:l,className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Add First Item"]})]})]})]})}export{ne as T};
